<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food Journey - Eat Lah!</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    html, body, * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Open Sans', Arial, sans-serif;
      background: #f8f8f8;
      color: #222;
      min-height: 100vh;
      height: 100vh;
      overflow: hidden;
    }
    .header {
      background: #2e7d32;
      color: #fff;
      padding: 2rem 1rem 1rem 1rem;
      text-align: center;
      border-bottom-left-radius: 32px;
      border-bottom-right-radius: 32px;
      box-shadow: 0 4px 24px rgba(46,125,50,0.12);
      margin-bottom: 0;
      max-width: 100vw;
    }
    .header h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.2rem;
      margin: 0;
      letter-spacing: 2px;
      font-weight: 700;
    }
    .back-btn {
      display: inline-block;
      margin: 2rem auto 0 auto;
      background: #fff;
      color: #2e7d32;
      border: 2px solid #2e7d32;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      font-size: 1.08rem;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.2s, color 0.2s;
      max-width: 90vw;
      box-sizing: border-box;
    }
    .back-btn:hover {
      background: #2e7d32;
      color: #fff;
    }
    #food-journey-story {
      margin: 0;
      height: calc(100vh - 80px);
      min-height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 100vw;
      overflow: hidden;
      flex-direction: column;
    }
    .fj-panel {
      width: 100%;
      max-width: 100vw;
      height: calc(100vh - 80px);
      max-height: calc(100vh - 80px);
      min-height: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: transparent;
      box-shadow: none;
      border-radius: 0;
      padding: 0;
      animation: fadeInPanel 0.7s cubic-bezier(.5,1.5,.5,1);
      overflow: hidden;
      margin: 0 auto;
    }
    @keyframes fadeInPanel {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fj-panel-inner {
      background: #fffde7;
      border-radius: 24px;
      box-shadow: 0 4px 24px #2e7d3222;
      padding: 2rem 1.2rem;
      max-width: 400px;
      margin: 0 auto;
      text-align: center;
      animation: fadeInPanel 0.7s cubic-bezier(.5,1.5,.5,1);
      width: 90vw;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .fj-harvest-scene {
      position: relative;
      width: 100%;
      max-width: 600px;
      height: 48vh;
      min-height: 180px;
      max-height: 60vh;
      margin: 0 auto 1.2rem auto;
      overflow: hidden;
      border-radius: 24px;
      box-shadow: 0 4px 24px #2e7d3222;
      background: linear-gradient(to bottom,#90caf9 70%,#fff 100%);
      animation: fadeInPanel 0.7s cubic-bezier(.5,1.5,.5,1);
      box-sizing: border-box;
      left: 0; right: 0;
    }
    .fj-sun {
      position: absolute;
      top: 6%;
      left: 7%;
      font-size: 2.8rem;
      z-index: 2;
      filter: drop-shadow(0 0 12px #fffde7cc);
      animation: sunSpin 12s linear infinite;
      transform-origin: 60% 60%;
      max-width: 12vw;
      max-height: 12vw;
    }
    @keyframes sunSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .fj-cloud {
      position: absolute;
      top: 18%;
      left: 20%;
      font-size: 2.2rem;
      z-index: 2;
      opacity: 0.85;
      animation: cloudDrift 18s linear infinite;
      max-width: 14vw;
    }
    .fj-cloud2 {
      left: 65%;
      top: 10%;
      font-size: 2.6rem;
      animation: cloudDrift2 22s linear infinite;
      max-width: 16vw;
    }
    @keyframes cloudDrift {
      0% { left: 20%; }
      100% { left: 80%; }
    }
    @keyframes cloudDrift2 {
      0% { left: 65%; }
      100% { left: 5%; }
    }
    .fj-field {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 38%;
      background: linear-gradient(to top,#66bb6a 80%,#a5d6a7 100%);
      border-bottom-left-radius: 24px;
      border-bottom-right-radius: 24px;
      z-index: 3;
      animation: fieldShimmer 4s ease-in-out infinite alternate;
      box-sizing: border-box;
    }
    @keyframes fieldShimmer {
      0% { filter: brightness(1); }
      100% { filter: brightness(1.08) saturate(1.1); }
    }
    .fj-wheat-row {
      position: absolute;
      bottom: 18%;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-evenly;
      align-items: flex-end;
      z-index: 4;
      pointer-events: auto;
      max-width: 100vw;
    }
    .wheat-emoji {
      font-size: min(2.6rem,6vw) !important;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
      user-select: none;
      filter: drop-shadow(0 2px 4px #2e7d3222);
      animation: wheatSway 2.5s ease-in-out infinite alternate;
      display: inline-block;
      max-width: 8vw;
    }
    @keyframes wheatSway {
      0% { transform: rotate(-6deg) scale(1); }
      50% { transform: rotate(7deg) scale(1.04); }
      100% { transform: rotate(-6deg) scale(1); }
    }
    .wheat-emoji.harvested {
      animation: wheatHarvest 0.5s cubic-bezier(.5,1.7,.5,1) forwards !important;
      opacity: 0.4 !important;
    }
    @keyframes wheatHarvest {
      0% { transform: scale(1) rotate(0); opacity: 1; }
      40% { transform: scale(1.3) rotate(-20deg); opacity: 1; }
      100% { transform: scale(0.7) rotate(-30deg); opacity: 0.2; }
    }
    .fj-emoji-anim {
      animation: fadeInPanel 0.7s cubic-bezier(.5,1.5,.5,1);
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Food Journey</h1>
  </div>
  <div id="food-journey-story"></div>
  <div id="return-menu-btn" style="display:none;text-align:center;"></div>
  <script src="eat-lah-menu.js"></script>
  <script>
    // Only show if coming from an order
    if (localStorage.getItem('show_food_journey')) {
      localStorage.removeItem('show_food_journey');
      // Patch renderFoodJourneyStory to show a return button at the end
      const origRender = window.renderFoodJourneyStory;
      window.renderFoodJourneyStory = function() {
        let storyIdx = 0;
        const story = [
          {
            emoji: 'üå±',
            title: 'It Starts on the Farm',
            text: 'Our journey begins with local farmers planting and nurturing crops and raising animals with care.',
            interactive: 'harvest',
          },
          {
            emoji: 'üöú',
            title: 'Harvest & Collection',
            text: 'When the time is right, ingredients are harvested and collected fresh from the fields.',
            interactive: null,
          },
          {
            emoji: 'üöö',
            title: 'Transport to Market',
            text: 'The fresh produce and ingredients are delivered to local markets and restaurants, reducing food miles.',
            interactive: 'quiz',
          },
          {
            emoji: 'üë©‚Äçüç≥',
            title: 'Prepared by Our Chefs',
            text: 'Our chefs select the best local ingredients and prepare your meal with love and skill.',
            interactive: null,
          },
          {
            emoji: 'üçΩÔ∏è',
            title: 'Served to You',
            text: 'Your delicious meal is served, fresh and full of local flavor. Enjoy!',
            interactive: null,
          },
          {
            emoji: 'üéâ',
            title: 'You Did It!',
            text: "Thanks for learning about your food's journey! Here's a 10% off coupon for your next order: <b>EATLAH10</b>",
            interactive: null,
          }
        ];
        let storyDiv = document.getElementById('food-journey-story');
        function renderPanel() {
          const s = story[storyIdx];
          let visual = `<div style='font-size:3rem;'>${s.emoji}</div>`;
          if (s.interactive === 'harvest') {
            const wheatCount = 8;
            let harvested = 0;
            // Visual: full screen field, sky, sun, wheat row, clouds
            visual = `
              <div class='fj-harvest-scene'>
                <div class='fj-sun'>‚òÄÔ∏è</div>
                <div class='fj-cloud'>‚òÅÔ∏è</div>
                <div class='fj-cloud fj-cloud2'>‚òÅÔ∏è</div>
                <div class='fj-field'></div>
                <div class='fj-wheat-row' id='wheat-row'>
                  ${Array.from({length: wheatCount}).map((_,i) => `<span class='wheat-emoji' data-idx='${i}'>üåæ</span>`).join('')}
                </div>
              </div>
            `;
            storyDiv.innerHTML = `
              <div class='fj-panel'>
                <div class='fj-panel-inner'>
                  ${visual}
                  <div style=\"font-weight:700;font-size:1.2rem;color:#2e7d32;margin:1rem 0 0.5rem 0;\">${s.title}</div>
                  <div style=\"font-size:1.08rem;color:#333;margin-bottom:1.5rem;\">Click each wheat to harvest!</div>
                  <div id='harvest-progress' style='color:#2e7d32;font-weight:600;margin-bottom:1rem;'>0 / ${wheatCount} harvested</div>
                </div>
              </div>
            `;
            const wheatEls = Array.from(storyDiv.querySelectorAll('.wheat-emoji'));
            wheatEls.forEach(el => {
              el.onclick = function() {
                if (!el.classList.contains('harvested')) {
                  el.classList.add('harvested');
                  harvested++;
                  document.getElementById('harvest-progress').textContent = `${harvested} / ${wheatCount} harvested`;
                  if (harvested === wheatCount) {
                    setTimeout(() => {
                      storyIdx++;
                      renderPanel();
                    }, 600);
                  }
                }
              };
            });
            document.getElementById('return-menu-btn').style.display = 'none';
            return;
          }
          if (s.interactive === 'quiz') {
            // Multi-question quiz: 30 questions, pick 10 at random, randomize answer order
            const allQuizQuestions = [
              { q: 'Why is eating local food better for the environment?', choices: [
                'It reduces food miles and emissions',
                'It makes food more expensive',
                'It takes longer to reach you'
              ], correct: 0 },
              { q: 'Which of these is a benefit of supporting local farmers?', choices: [
                'Fresher ingredients',
                'More imported food',
                'Higher pollution'
              ], correct: 0 },
              { q: 'What does "food miles" mean?', choices: [
                'The distance food travels from farm to plate',
                'The number of meals you eat',
                'The price of food'
              ], correct: 0 },
              { q: 'Which is a local Singaporean dish?', choices: [
                'Chicken Rice',
                'Pizza',
                'Tacos'
              ], correct: 0 },
              { q: 'Buying local food helps to...', choices: [
                'Support the local economy',
                'Increase food miles',
                'Reduce food freshness'
              ], correct: 0 },
              { q: 'Which is a sustainable farming practice?', choices: [
                'Crop rotation',
                'Overfishing',
                'Deforestation'
              ], correct: 0 },
              { q: 'Which ingredient is NOT in Nasi Lemak?', choices: [
                'Pepperoni',
                'Coconut rice',
                'Egg'
              ], correct: 0 },
              { q: 'What is the main benefit of eating seasonal produce?', choices: [
                'It is fresher and tastier',
                'It is always imported',
                'It is more expensive'
              ], correct: 0 },
              { q: 'Which is a negative impact of long food transport?', choices: [
                'More carbon emissions',
                'Fresher food',
                'Lower costs'
              ], correct: 0 },
              { q: 'Which is a local fruit in Southeast Asia?', choices: [
                'Mango',
                'Apple',
                'Blueberry'
              ], correct: 0 },
              { q: 'What is a farmers\' market?', choices: [
                'A place where local farmers sell directly',
                'A supermarket chain',
                'A type of fertilizer'
              ], correct: 0 },
              { q: 'Which is a benefit of organic farming?', choices: [
                'Fewer chemicals used',
                'More pollution',
                'Lower soil quality'
              ], correct: 0 },
              { q: 'Which is a traditional way to preserve food?', choices: [
                'Pickling',
                'Plastic wrapping',
                'Spray painting'
              ], correct: 0 },
              { q: 'Which is a sign of fresh produce?', choices: [
                'Bright color and firm texture',
                'Wilted leaves',
                'Bruised skin'
              ], correct: 0 },
              { q: 'Which is a local source of protein?', choices: [
                'Eggs',
                'Candy',
                'Soda'
              ], correct: 0 },
              { q: 'Which is a way to reduce food waste?', choices: [
                'Planning meals and using leftovers',
                'Throwing away extra food',
                'Buying more than needed'
              ], correct: 0 },
              { q: 'Which is a benefit of eating at Eat Lah!?', choices: [
                'Locally sourced ingredients',
                'Imported fast food',
                'No vegetarian options'
              ], correct: 0 },
              { q: 'Which is a healthy cooking method?', choices: [
                'Steaming',
                'Deep frying everything',
                'Adding lots of sugar'
              ], correct: 0 },
              { q: 'Which is a local vegetable?', choices: [
                'Kang Kong (water spinach)',
                'Broccoli from Europe',
                'Potato chips'
              ], correct: 0 },
              { q: 'Which is a benefit of eating less processed food?', choices: [
                'More nutrients',
                'More additives',
                'Longer ingredient lists'
              ], correct: 0 },
              { q: 'Which is a way to support local farmers?', choices: [
                'Buy from local markets',
                'Ignore local produce',
                'Only buy imported snacks'
              ], correct: 0 },
              { q: 'Which is a local Singaporean dessert?', choices: [
                'Mango Sticky Rice',
                'Chocolate Cake',
                'Apple Pie'
              ], correct: 0 },
              { q: 'Which is a benefit of eating local seafood?', choices: [
                'It is fresher and supports local fishers',
                'It is always frozen',
                'It is imported from far away'
              ], correct: 0 },
              { q: 'Which is a way to eat more sustainably?', choices: [
                'Eat more plant-based meals',
                'Eat only imported meat',
                'Waste more food'
              ], correct: 0 },
              { q: 'Which is a local herb used in cooking?', choices: [
                'Pandan',
                'Rosemary from Europe',
                'Artificial flavoring'
              ], correct: 0 },
              { q: 'Which is a benefit of eating local eggs?', choices: [
                'They are fresher and support local farmers',
                'They are imported',
                'They are always more expensive'
              ], correct: 0 },
              { q: 'Which is a way to reduce packaging waste?', choices: [
                'Bring your own bag',
                'Use more plastic',
                'Throw away reusable containers'
              ], correct: 0 },
              { q: 'Which is a local leafy green?', choices: [
                'Chye Sim',
                'Iceberg lettuce from USA',
                'Potato chips'
              ], correct: 0 },
              { q: 'Which is a benefit of eating local chicken?', choices: [
                'It is fresher and supports local farmers',
                'It is always imported',
                'It is less tasty'
              ], correct: 0 },
              { q: 'Which is a way to learn about your food?', choices: [
                'Ask about the source at restaurants',
                'Never ask questions',
                'Only eat packaged snacks'
              ], correct: 0 },
              { q: 'Which is a local root vegetable?', choices: [
                'Sweet potato',
                'French fries',
                'Imported carrots'
              ], correct: 0 }
            ];
            // Randomize correct answer positions
            const randomizedQuestions = allQuizQuestions.map(q => {
              const indices = [0,1,2];
              for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
              }
              const newChoices = indices.map(i => q.choices[i]);
              const newCorrect = indices.indexOf(q.correct);
              return { q: q.q, choices: newChoices, correct: newCorrect };
            });
            // Shuffle questions and pick 10
            function shuffle(arr) {
              for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
              }
              return arr;
            }
            const quizQuestions = shuffle(randomizedQuestions).slice(0, 10);
            let quizIdx = 0;
            function renderQuizQ() {
              visual = `<div style='font-size:3rem;'>üöö</div>`;
              const q = quizQuestions[quizIdx];
              storyDiv.innerHTML = `
                <div class='fj-panel'>
                  <div class='fj-panel-inner' style='animation:fadeInPanel 0.7s cubic-bezier(.5,1.5,.5,1);'>
                    ${visual}
                    <div style="font-weight:700;font-size:1.2rem;color:#2e7d32;margin:1rem 0 0.5rem 0;">${s.title}</div>
                    <div style="font-size:1.08rem;color:#333;margin-bottom:1.5rem;">${q.q}</div>
                    ${q.choices.map((c,i) => `<button class='quiz-btn' data-idx='${i}' style='background:#e8f5e9;color:#2e7d32;border:2px solid #2e7d32;padding:0.5rem 1.2rem;border-radius:8px;font-size:1rem;font-weight:700;cursor:pointer;margin:0.3rem;'>${c}</button><br>`).join('')}
                    <div id='quiz-feedback' style='margin-top:1rem;font-weight:600;color:#c62828;min-height:1.5em;'></div>
                    <div id='quiz-menu-btn' style='margin-top:1.5rem;'></div>
                  </div>
                </div>
              `;
              const btns = Array.from(storyDiv.querySelectorAll('.quiz-btn'));
              btns.forEach((btn, i) => {
                btn.onclick = () => {
                  if (i === q.correct) {
                    document.getElementById('quiz-feedback').textContent = 'Correct!';
                    btns.forEach(b => b.disabled = true);
                    btn.style.background = '#2e7d32';
                    btn.style.color = '#fff';
                    setTimeout(() => {
                      if (quizIdx < quizQuestions.length - 1) {
                        quizIdx++;
                        renderQuizQ();
                      } else {
                        // Show back to menu button after last question
                        document.getElementById('quiz-menu-btn').innerHTML = `<a href='eat-lah-menu.html' class='back-btn'>Back to Menu</a>`;
                        setTimeout(() => {
                          storyIdx++;
                          renderPanel();
                        }, 1200);
                      }
                    }, 900);
                  } else {
                    document.getElementById('quiz-feedback').textContent = 'Try again!';
                  }
                };
              });
              document.getElementById('return-menu-btn').style.display = 'none';
            }
            renderQuizQ();
            return;
          }
          // Default: normal panel with visual
          storyDiv.innerHTML = `
            <div style=\"max-width:340px;margin:2rem auto;background:#fffde7;border-radius:18px;box-shadow:0 4px 24px #2e7d3222;padding:2rem 1.2rem;text-align:center;\">
              ${visual}
              <div style=\"font-weight:700;font-size:1.2rem;color:#2e7d32;margin:1rem 0 0.5rem 0;\">${s.title}</div>
              <div style=\"font-size:1.08rem;color:#333;margin-bottom:1.5rem;\">${s.text}</div>
              ${storyIdx < story.length-1 ? `<button style='background:#2e7d32;color:#fff;border:none;padding:0.6rem 1.5rem;border-radius:8px;font-size:1rem;font-weight:700;cursor:pointer;' id='story-next-btn'>Next</button>` : ''}
            </div>
          `;
          if (storyIdx === story.length-1) {
            // At the end, let user pick a coupon
            function makeCode(prefix) {
              const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
              let code = '';
              for (let i = 0; i < 6; i++) code += chars[Math.floor(Math.random() * chars.length)];
              return prefix + '-' + code;
            }
            const code5 = makeCode('EATLAH5');
            const code10 = makeCode('EATLAH10');
            let picked = null;
            storyDiv.innerHTML = `
              <div class='fj-panel'>
                <div class='fj-panel-inner'>
                  <div style='font-size:2.2rem;margin-bottom:1rem;'>üéâ</div>
                  <div style='font-weight:700;font-size:1.2rem;color:#2e7d32;margin:1rem 0 0.5rem 0;'>You Did It!</div>
                  <div style='font-size:1.08rem;color:#333;margin-bottom:1.5rem;'>Thanks for learning about your food's journey!<br>Pick your reward:</div>
                  <button id='pick-5' style='background:#2e7d32;color:#fff;border:none;padding:0.7rem 1.5rem;border-radius:8px;font-size:1.08rem;font-weight:700;cursor:pointer;margin:0.5rem 0;'>5% off NOW</button><br>
                  <button id='pick-10' style='background:#388e3c;color:#fff;border:none;padding:0.7rem 1.5rem;border-radius:8px;font-size:1.08rem;font-weight:700;cursor:pointer;margin:0.5rem 0;'>10% off NEXT VISIT</button>
                  <div id='coupon-picked' style='margin-top:1.5rem;font-weight:600;color:#2e7d32;min-height:2em;'></div>
                </div>
              </div>
            `;
            document.getElementById('pick-5').onclick = function() {
              picked = '5';
              if (typeof window !== 'undefined') {
                localStorage.setItem('eatlah_coupon', code5);
                localStorage.removeItem('eatlah_future_coupon');
              }
              document.getElementById('coupon-picked').innerHTML = `You picked <b>5% off now</b>! Your code has been saved. Enter it at checkout to redeem. <br><a href='eat-lah-menu.html' class='back-btn' style='margin-top:1.2rem;'>Back to Menu</a>`;
            };
            document.getElementById('pick-10').onclick = function() {
              picked = '10';
              if (typeof window !== 'undefined') {
                localStorage.setItem('eatlah_future_coupon', code10);
                localStorage.removeItem('eatlah_coupon');
              }
              document.getElementById('coupon-picked').innerHTML = `You picked <b>10% off your next visit</b>! Your code has been saved. Enter it at checkout to redeem. <br><a href='eat-lah-menu.html' class='back-btn' style='margin-top:1.2rem;'>Back to Menu</a>`;
            };
            document.getElementById('return-menu-btn').style.display = 'none';
            return;
          } else {
            document.getElementById('return-menu-btn').style.display = 'none';
          }
          const nextBtn = document.getElementById('story-next-btn');
          if (nextBtn) {
            nextBtn.onclick = () => {
              storyIdx++;
              renderPanel();
            };
          }
        }
        renderPanel();
      };
      window.renderFoodJourneyStory();
    } else {
      // If accessed directly, show a message and a button to return
      document.getElementById('food-journey-story').innerHTML = `<div style='max-width:340px;margin:2rem auto;background:#fffde7;border-radius:18px;box-shadow:0 4px 24px #2e7d3222;padding:2rem 1.2rem;text-align:center;'><div style='font-size:2.2rem;'>üçΩÔ∏è</div><div style='font-weight:700;font-size:1.2rem;color:#2e7d32;margin:1rem 0 0.5rem 0;'>No story to show</div><div style='font-size:1.08rem;color:#333;margin-bottom:1.5rem;'>Please place an order to experience the food journey!</div><a href='eat-lah-menu.html' class='back-btn'>Back to Menu</a></div>`;
    }
  </script>
</body>
</html> 